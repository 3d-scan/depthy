window.Modernizr=function(a,b,c){function d(a){s.cssText=a}function e(a,b){return typeof a===b}function f(a,b){return!!~(""+a).indexOf(b)}function g(a,b){for(var d in a){var e=a[d];if(!f(e,"-")&&s[e]!==c)return"pfx"==b?e:!0}return!1}function h(a,b,d){for(var f in a){var g=b[a[f]];if(g!==c)return d===!1?a[f]:e(g,"function")?g.bind(d||b):g}return!1}function i(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),f=(a+" "+v.join(d+" ")+d).split(" ");return e(b,"string")||e(b,"undefined")?g(f,b):(f=(a+" "+w.join(d+" ")+d).split(" "),h(f,b,c))}var j,k,l,m="2.8.0",n={},o=!0,p=b.documentElement,q="modernizr",r=b.createElement(q),s=r.style,t=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),u="Webkit Moz O ms",v=u.split(" "),w=u.toLowerCase().split(" "),x={},y=[],z=y.slice,A=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),k=b.body,l=k||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:q+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',q,'">',a,"</style>"].join(""),j.id=q,(k?j:l).innerHTML+=f,l.appendChild(j),k||(l.style.background="",l.style.overflow="hidden",i=p.style.overflow,p.style.overflow="hidden",p.appendChild(l)),g=c(j,a),k?j.parentNode.removeChild(j):(l.parentNode.removeChild(l),p.style.overflow=i),!!g},B={}.hasOwnProperty;l=e(B,"undefined")||e(B.call,"undefined")?function(a,b){return b in a&&e(a.constructor.prototype[b],"undefined")}:function(a,b){return B.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=z.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(z.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(z.call(arguments)))};return d}),x.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},x.webgl=function(){return!!a.WebGLRenderingContext},x.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:A(["@media (",t.join("touch-enabled),("),q,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c},x.webworkers=function(){return!!a.Worker};for(var C in x)l(x,C)&&(k=C.toLowerCase(),n[k]=x[C](),y.push((n[k]?"":"no-")+k));return n.addTest=function(a,b){if("object"==typeof a)for(var d in a)l(a,d)&&n.addTest(d,a[d]);else{if(a=a.toLowerCase(),n[a]!==c)return n;b="function"==typeof b?b():b,"undefined"!=typeof o&&o&&(p.className+=" "+(b?"":"no-")+a),n[a]=b}return n},d(""),r=j=null,n._version=m,n._prefixes=t,n._domPrefixes=w,n._cssomPrefixes=v,n.testProp=function(a){return g([a])},n.testAllProps=i,n.testStyles=A,n.prefixed=function(a,b,c){return b?i(a,b,c):i(a,"pfx")},p.className=p.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(o?" js "+y.join(" "):""),n}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==q.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=r.shift();s=1,a?a.t?o(function(){("c"==a.t?m.injectCss:m.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):s=0}function i(a,c,d,e,f,i,j){function k(b){if(!n&&g(l.readyState)&&(t.r=n=1,!s&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&o(function(){v.removeChild(l)},50);for(var d in A[c])A[c].hasOwnProperty(d)&&A[c][d].onload()}}var j=j||m.errorTimeout,l=b.createElement(a),n=0,q=0,t={t:d,s:c,e:f,a:i,x:j};1===A[c]&&(q=1,A[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,q)},r.splice(e,0,t),"img"!=a&&(q||2===A[c]?(v.insertBefore(l,u?null:p),o(k,j)):A[c].push(l))}function j(a,b,c,d,f){return s=0,b=b||"j",e(a)?i("c"==b?x:w,a,b,this.i++,c,d,f):(r.splice(this.i++,0,a),1==r.length&&h()),this}function k(){var a=m;return a.loader={load:j,i:0},a}var l,m,n=b.documentElement,o=a.setTimeout,p=b.getElementsByTagName("script")[0],q={}.toString,r=[],s=0,t="MozAppearance"in n.style,u=t&&!!b.createRange().compareNode,v=u?n:p.parentNode,n=a.opera&&"[object Opera]"==q.call(a.opera),n=!!b.attachEvent&&!n,w=t?"object":n?"script":"img",x=n?"script":w,y=Array.isArray||function(a){return"[object Array]"==q.call(a)},z=[],A={},B={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}};m=function(a){function b(a){var b,c,d,a=a.split("!"),e=z.length,f=a.pop(),g=a.length,f={url:f,origUrl:f,prefixes:a};for(c=0;g>c;c++)d=a[c].split("="),(b=B[d.shift()])&&(f=b(f,d));for(c=0;e>c;c++)f=z[c](f);return f}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(A[i.url]?i.noexec=!0:A[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),A[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(l=function(){var a=[].slice.call(arguments);m.apply(this,a),n()}),g(a,l,b,0,j);else if(Object(a)===a)for(i in h=function(){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c}(),a)a.hasOwnProperty(i)&&(!c&&!--h&&(d(l)?l=function(){var a=[].slice.call(arguments);m.apply(this,a),n()}:l[i]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),n()}}(m[i])),g(a[i],l,b,i,j))}else!c&&n()}var h,i,j=!!a.test,k=a.load||a.both,l=a.callback||f,m=l,n=a.complete||f;c(j?a.yep:a.nope,!!k),k&&c(k)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(y(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):y(j)?m(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},m.addPrefix=function(a,b){B[a]=b},m.addFilter=function(a){z.push(a)},m.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",l=function(){b.removeEventListener("DOMContentLoaded",l,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k,l,n=b.createElement("script"),e=e||m.errorTimeout;n.src=a;for(l in d)n.setAttribute(l,d[l]);c=j?h:c||f,n.onreadystatechange=n.onload=function(){!k&&g(n.readyState)&&(k=1,c(),n.onload=n.onreadystatechange=null)},o(function(){k||(k=1,c(1))},e),i?n.onload():p.parentNode.insertBefore(n,p)},a.yepnope.injectCss=function(a,c,d,e,g,i){var j,e=b.createElement("link"),c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(p.parentNode.insertBefore(e,p),o(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("devicemotion","DeviceMotionEvent"in window),Modernizr.addTest("deviceorientation","DeviceOrientationEvent"in window),Modernizr.addTest("filereader",function(){return!!(window.File&&window.FileList&&window.FileReader)}),Modernizr.addTest("performance",!!Modernizr.prefixed("performance",window)),function(){var a=new Image;a.onerror=function(){Modernizr.addTest("webp",!1)},a.onload=function(){Modernizr.addTest("webp",function(){return 1==a.width})},a.src="data:image/webp;base64,UklGRiwAAABXRUJQVlA4ICAAAAAUAgCdASoBAAEAL/3+/3+CAB/AAAFzrNsAAP5QAAAAAA=="}(),function(){"use strict";Modernizr.addTest("ios",/iPad|iPhone|iPod/.test(window.navigator.userAgent)),Modernizr.addTest("android",/Android/i.test(window.navigator.userAgent)),Modernizr.addTest("winphone",/IEMobile/i.test(window.navigator.userAgent)),Modernizr.addTest("mobile",/iPad|iPhone|iPod|Android|IEMobile/.test(window.navigator.userAgent)),Modernizr.addTest("ff",/Firefox/.test(window.navigator.userAgent)),Modernizr.addTest("ie",/; MSIE/.test(window.navigator.userAgent)),Modernizr.addTest("chrome",/\bChrome\b/.test(window.navigator.userAgent)),Modernizr.addTest("safari",/\bSafari\b/.test(window.navigator.userAgent)&&!/\bChrome\b/.test(window.navigator.userAgent))}(),angular.module("depthyApp",["ngAnimate","ga","shareUrls","ui.bootstrap.buttons","ui.bootstrap.modal","ui.bootstrap.transition"]).config(["$compileProvider",function(a){a.imgSrcSanitizationWhitelist(/^\s*(https?|blob):|data:image\//),a.aHrefSanitizationWhitelist(/^\s*(https?|blob):/)}]),angular.module("depthyApp").provider("depthy",function(){var a={compoundSource:!1,imageSource:!1,depthSource:!1,sourcesReady:!1,sourcesDirty:1};this.$get=["ga","$timeout","$rootScope","$document","$q",function(b,c,d,e,f){var g={viewer:a,loadedSample:!1,loadedName:!1,animatePopuped:!1,exportPopuped:!1,exportSize:Modernizr.mobile?150:300,exportType:"gif",imgurId:"b4ca5b16efb904b",loadSample:function(b){a.compoundSource="samples/"+b+"-compound.jpg",a.depthSource="samples/"+b+"-depth.jpg",a.imageSource="samples/"+b+"-image.jpg",a.sourcesReady=!0,a.sourcesDirty++,a.metadata={},a.error=!1,g.loadedSample=g.loadedName=b},handleCompoundFile:function(e){var f=function(c){a.imageSource=!1,a.depthSource=!1,a.compoundSource=!1,a.sourcesReady=!0,a.sourcesDirty++,a.metadata={},g.loadedSample=g.loadedName=!1,a.error=c,b("send","event","image","error",c)};return"image/jpeg"!==e.type?void f("Only JPEGs are supported!"):(g.loadedSample=!1,g.loadedName=(e.name||"").replace(/\.(jpe?g|png)$/i,""),a.sourcesReady=!1,a.error=!1,a.sourcesDirty++,void c(function(){var c=new FileReader,h=0;c.onload=function(c){a.error=!1;try{var e=g.parseCompoundImage(c.target.result);b("send","event","image","parsed"),a.imageSource=e.imageUri,a.depthSource=e.depthUri,delete e.imageData,delete e.depthData,delete e.imageUri,delete e.depthUri,a.metadata=e,a.sourcesReady=++h>1,a.sourcesDirty++}catch(c){f(c)}d.$apply()},c.readAsBinaryString(e);var i=new FileReader;i.onload=function(b){a.compoundSource=b.target.result,a.sourcesReady=++h>1,a.sourcesDirty++,d.$apply()},i.readAsDataURL(e)},100))},parseCompoundImage:function(a){var b=(a.match(/xmpNote:HasExtendedXMP="(.+?)"/i)||[])[1];b&&(a=a.replace(new RegExp("[\\s\\S]{4}http:\\/\\/ns\\.adobe\\.com\\/xmp\\/extension\\/[\\s\\S]"+b+"[\\s\\S]{8}","g"),""));var c=a.match(/<x:xmpmeta [\s\S]+?<\/x:xmpmeta>/g),d={};if(!c)throw"No XMP metadata found!";if(c=c.join("\n",c),d.imageMime=(c.match(/GImage:Mime="(.+?)"/i)||[])[1],d.imageData=(c.match(/GImage:Data="(.+?)"/i)||[])[1],d.depthMime=(c.match(/GDepth:Mime="(.+?)"/i)||[])[1],d.depthData=(c.match(/GDepth:Data="(.+?)"/i)||[])[1],d.imageMime&&d.imageData&&(d.imageUri="data:"+d.imageMime+";base64,"+d.imageData),d.depthMime&&d.depthData&&(d.depthUri="data:"+d.depthMime+";base64,"+d.depthData),!d.depthUri)throw"No depth map found!";if(!d.imageUri)throw"No original image found!";return d.focalDistance=(c.match(/GFocus:FocalDistance="(.+?)"/i)||[])[1],d},exportAnimation:function(){var b,c=f.defer(),h=c.promise;return Modernizr.load({test:window.GIF,nope:"bower_components/gif.js/dist/gif.js",complete:function(){var f={width:g.exportSize,height:g.exportSize},i=a.animDuration,j=Math.min(25,Math.max(8,a.depthScale*(300>f?.5:1)*15/i)),k=Math.max(4,Math.round(i*j)),l=Math.round(1e3*i/k),m=e.find("[pixi]"),n=m.controller("pixi");g.viewer.overrideStageSize=f,d.$safeApply(),b=new GIF({workers:2,quality:10,workerScript:"bower_components/gif.js/dist/gif.worker.js"}),console.log("FPS %d Frames %d Delay %d Scale %d Size %d Duration %d",j,k,l,a.depthScale,g.exportSize,i);for(var o=0;k>o;++o)a.animPosition=o/k,a.update=1,n.render(!0),b.addFrame(m[0],{copy:!0,delay:l});a.animPosition=null,b.on("progress",function(a){c.notify(a)}),b.on("abort",function(){h.abort=function(){},c.reject()}),b.on("finished",function(a){h.abort=function(){},c.resolve(a),g.viewer.overrideStageSize=null,d.$safeApply()}),b.render()}}),h.abort=function(){b.abort()},h}};return g}]}),angular.module("depthyApp").controller("MainCtrl",["$rootScope","$window","$scope","$timeout","ga","depthy","$element","$modal",function(a,b,c,d,e,f,g,h){a.depthy=f,a.viewer=f.viewer,a.Modernizr=window.Modernizr,e("set","dimension1",(Modernizr.webgl?"webgl":"no-webgl")+" "+(Modernizr.webp?"webp":"no-webp")),f.loadSample("flowers",!1),a.$safeApply=function(a){var b=this.$root.$$phase;"$apply"===b||"$digest"===b?a&&"function"==typeof a&&a():this.$apply(a)},c.hasImage=function(){return!!f.viewer.imageSource},c.hasDepth=function(){return!!f.viewer.depthSource},c.loadSample=function(a){f.loadSample(a),e("send","event","sample",a)},c.getNextDepthScaleName=function(){var a=f.viewer.depthScale;return a>1.05?"Tranquilize":.95>a?"Normalize":"Dramatize"},c.cycleDepthScale=function(){var a=f.viewer.depthScale;a=a>1.05?.5:.95>a?1:2,c.animateOption(f.viewer,{depthScale:a})},c.animateOption=function(a,b,d){$(a).animate(b,{duration:d||250,step:function(){c.$safeApply()},complete:function(){_.extend(a,b),c.$safeApply()}})},c.$watch("compoundFiles",function(a){a&&a.length&&f.handleCompoundFile(a[0])}),c.$watch("depthy.viewer.sourcesDirty",function(){var a=g.find('[image-source="image"]')[0],b=g.find('[image-source="depth"]')[0];a&&a.src!==f.viewer.imageSource&&(a.src=f.viewer.imageSource||""),b&&b.src!==f.viewer.depthSource&&(b.src=f.viewer.depthSource||"")}),c.toggleAnimatePopup=function(){f.animatePopuped||(f.viewer.animate=!0),f.exportPopuped=!1,f.animatePopuped=!f.animatePopuped},c.toggleExportPopup=function(){f.exportPopuped||(f.viewer.animate=!0),f.animatePopuped=!1,f.exportPopuped=!f.exportPopuped},c.$watch("(depthy.exportPopuped || depthy.exportActive) && depthy.exportSize",function(a){f.viewer.overrideStageSize=a?{width:a,height:a}:null}),c.startExport=function(){f.exportActive=!0,h.open({templateUrl:"views/export-modal.html",controller:"ExportModalCtrl",backdrop:"static",keyboard:!1,windowClass:"export-modal"}).result.finally(function(){f.exportActive=!1}),f.exportPopuped=!1,f.viewer.animate=!1},c.$on("pixi.webgl.init.exception",function(a,b){console.error("WebGL Init Exception",b),Modernizr.webgl=!1,e("send","event","webgl","exception",b.toString(),{nonInteraction:1})}),$(b).on("resize",function(){f.viewer.maxSize={width:1*b.innerWidth,height:.8*b.innerHeight},c.$safeApply()}),$(b).resize()}]),angular.module("depthyApp").directive("fileselect",["$parse",function(a){return{restrict:"A",scope:!0,link:function(b,c,d){function e(c){b.$broadcast("fileselect",c),d.fileselect&&a(d.fileselect).assign(b,c)}var f=document.createElement("input");f.type="file",f.style.visibility="hidden",f.style.position="absolute",f.style.left="-9000px",c.append(f);var g=function(a){a.stopPropagation(),a.preventDefault()},h=function(a){a.stopPropagation(),a.preventDefault(),console.log(a);var c=a.originalEvent.dataTransfer,d=c.files;e(d),b.$apply()};b.selectFile=function(a){f.click(),a&&a.preventDefault()},c.on("dragenter",g),c.on("dragover",g),c.on("drop",h),f.addEventListener("change",function(){e(this.files),b.$apply()},!1)}}}]),angular.module("depthyApp").directive("pixi",["$parse",function(a){return{restrict:"A",scope:!1,controller:["$scope","$element","$attrs",function(b,c,d){function e(){f.render(),requestAnimFrame(e)}var f=this,g=a(d.pixi),h=g(b),i=b.$eval(d.pixiRender);h||(h=new PIXI.Stage(b.$eval(d.pixiBackground||"0")),g.assign(b,h));var j,k=b.$eval(d.pixiAntialias||"false"),l=b.$eval(d.pixiTransparent||"false"),m=b.$eval(d.pixiRenderer||"auto");switch(m){case"canvas":j=new PIXI.CanvasRenderer(c.width(),c.height(),c[0],l);break;case"webgl":try{j=new PIXI.WebGLRenderer(c.width(),c.height(),c[0],l,k)}catch(n){return void b.$emit("pixi.webgl.init.exception",n)}break;default:j=PIXI.autoDetectRenderer(c.width(),c.height(),c[0],k,l)}this.render=function(a){var b=!0;i&&(b=i(h,j)),(a||b!==!1)&&j.render(h)},requestAnimFrame(e),this.getStage=function(){return h},this.getRenderer=function(){return j},this.getContext=function(){return j.gl?j.gl:j.context}}]}}]),angular.module("depthyApp").directive("depthyViewer",["$window",function(a){return{restrict:"A",scope:!0,controller:["$scope","$element","$attrs",function(b,c,d){function e(){if(w.ready){var a=(Modernizr.mobile?.015:.015)*(w.depthScale||1),b=w.stageSize;s.scale={x:(b.width>b.height?1:b.height/b.width)*a,y:(b.width<b.height?1:b.width/b.height)*a},s.focus=w.depthFocus}}function f(a,c,d){return a&&a.baseTexture.imageUrl===c||(a&&(PIXI.Texture.removeTextureFromCache(a.baseTexture.imageUrl),a=null),w[d]=null,c&&(a=PIXI.Texture.fromImage(c),a.baseTexture.hasLoaded?(w[d]=a.frame,b.sizeDirty++):a.addEventListener("update",function(){w[d]=a.frame,b.sizeDirty++,b.$apply()}))),a}function g(a,b){var c=a.width/a.height;return a={width:a.width,height:a.height},a.height>b.height&&(a.height=b.height,a.width=a.height*c),a.width>b.width&&(a.width=b.width,a.height=a.width/c),a}function h(){n&&(u.removeChild(n),n=null,w.update=!0)}function i(d,i){u=d,v=i,b.$watch("[viewer.sourcesDirty, viewer.useCompoundImage, viewer.sourcesReady]",function(){w.sourcesReady&&(j=f(j,w[w.useCompoundImage&&w.compoundSource?"compoundSource":"imageSource"],"imageSize"),o=f(o,w.depthSource,"depthSize"))},!0),b.$watch("[viewer.imageSize, viewer.depthSize, viewer.sourcesReady, viewer.maxSize, viewer.overrideStageSize, sizeDirty]",function(){if(w.imageSize&&w.depthSize&&w.sourcesReady){var a=w.imageSize,b={width:a.width,height:a.height},c=null,d=w.maxSize;d&&(b=g(b,d)),c=b,w.overrideStageSize&&(c=g(a,w.overrideStageSize)),b={width:Math.round(b.width),height:Math.round(b.height)},c={width:Math.round(c.width),height:Math.round(c.height)},w.stageCssSize={width:c.width,height:c.height},!w.overrideStageSize&&window.devicePixelRatio>=2&&(c.width*=2,c.height*=2),w.viewerSize=b,w.stageSize=c}},!0),b.$watch("[viewer.stageSize, viewer.sourcesDirty, viewer.sourcesReady, viewer.depthBlurSize, viewer.depthFocus, viewer.error, sizeDirty]",function(){if(h(),w.ready=!w.error&&j&&o&&w.imageSize&&w.depthSize&&w.stageSize&&w.sourcesReady,w.ready){var a=w.imageSize,b=w.stageSize,c=w.depthBlurSize,d=b.width/a.width,f=1.05;v.resize(b.width,b.height),p=new PIXI.Sprite(o),t=new PIXI.BlurFilter,t.blur=c,p.filters=[t],p.scale=new PIXI.Point(d*f,d*f),q=new PIXI.DisplayObjectContainer,q.addChild(p),r=new PIXI.RenderTexture(b.width,b.height),r.render(q),s=new PIXI.DepthmapFilter(r),e(),k=new PIXI.Sprite(j),k.scale=new PIXI.Point(d*f,d*f),l=new PIXI.DisplayObjectContainer,l.addChild(k),m=new PIXI.RenderTexture(b.width,b.height),n=new PIXI.Sprite(m),n.filters=[s],m.render(l),u.addChild(n),w.update=!0}},!0),b.$watch("[viewer.depthScale, viewer.depthFocus]",e,!0),c.on("mousemove touchmove",function(a){if(w.ready&&!w.animate&&!angular.isNumber(w.animPosition)){var b=c.offset(),d=c.width(),e=c.height(),f=.8*w.stageSize.height,g=a.originalEvent.touches?a.originalEvent.touches[0]:a,h=(g.pageX-b.left)/d,i=(g.pageY-b.top)/e;h=Math.max(-1,Math.min(1,(2*h-1)*d/f)),i=Math.max(-1,Math.min(1,(2*i-1)*e/f)),s&&(w.offset={x:-h,y:-i},w.update=!0)}}),a.addEventListener("deviceorientation",function(a){if(w.ready&&!w.animate&&!angular.isNumber(w.animPosition)&&null!==a.beta&&null!==a.gamma){if(x){var b=window.innerHeight>window.innerWidth,c=.2*(a.beta-x.beta),d=.2*(a.gamma-x.gamma),e=b?-d:-c,f=b?-c:-d;e&&f&&(w.offset={x:Math.max(-1,Math.min(1,w.offset.x+e)),y:Math.max(-1,Math.min(1,w.offset.y+f))}),w.update=!0}x={alpha:a.alpha,beta:a.beta,gamma:a.gamma}}})}var j,k,l,m,n,o,p,q,r,s,t,u,v,w=b.v=b.$parent.$eval(d.depthyViewer),x={},y={x:0,y:0};_.defaults(w,{compoundSource:null,imageSource:null,depthSource:null,imageSize:null,depthSize:null,stageSize:null,stageCssSize:null,viewerSize:null,maxSize:null,overrideStageSize:null,sourcesReady:!0,sourcesDirty:null,useCompoundImage:!0,animate:!1,animDuration:2,animPosition:null,animScale:{x:1,y:.5},depthScale:1,depthBlurSize:16,offset:{x:0,y:0},easeFactor:Modernizr.mobile?.2:.9,depthFocus:.5,update:1,ready:!1}),b.stage=null,b.sizeDirty=0;var z=!1;b.pixiRender=function(a,c){if(!z)return i(a,c),z=!0,void b.$apply();if((w.offset.x!==y.x||w.offset.y!==y.y)&&(w.easeFactor&&!angular.isNumber(w.animPosition)?(y.x=y.x*w.easeFactor+w.offset.x*(1-w.easeFactor),y.y=y.y*w.easeFactor+w.offset.y*(1-w.easeFactor),Math.abs(y.x-w.offset.x)<1e-4&&Math.abs(y.y-w.offset.y)<1e-4&&(y=w.offset)):y=w.offset,s.offset={x:y.x,y:y.y},w.update=!0),w.animate||angular.isNumber(w.animPosition)){var d=angular.isNumber(w.animPosition)?w.animPosition*w.animDuration*1e3:Modernizr.performance?window.performance.now():(new Date).getTime();s.offset={x:Math.sin(d*Math.PI*2/w.animDuration/1e3)*w.animScale.x,y:Math.cos(d*Math.PI*2/w.animDuration/1e3)*w.animScale.y},w.update=!0}return w.update?void(w.update=!1):!1}}],link:function(){}}}]),angular.module("shareUrls",[]).provider("ShareUrls",function(){"use strict";function a(a,c){var d,e,f;for(d in c)e="{"+d+"}",-1!==a.indexOf(e)&&(a=a.replace(new RegExp(e,"g"),encodeURIComponent(c[d]))),f="{"+d+"-ne}",-1!==a.indexOf(f)&&(a=a.replace(new RegExp(f,"g"),c[d]));return b(a)}function b(a){a=a.replace(/\{([^{}]*)}/g,"");var b=a.match(/[^\=\&\?]+=[^\=\&\?]+/g),c=a.split("?")[0];return b&&b.length>0&&(c+="?"+b.join("&")),c}var c=this,d={facebook:{url:"http://www.facebook.com/sharer.php?s=100&p[url]={url}&p[images][0]={img}&p[title]={title}&p[summary]={desc}"},"facebook-feed":{url:"https://www.facebook.com/dialog/feed?app_id={app_id}&link={url}&picture={img}&name={title}&description={desc}&redirect_uri={redirect_url}"},"facebook-likebox":{url:"//www.facebook.com/plugins/like.php?href={url}&colorscheme={scheme}&layout={layout}&action={action}&show_faces=false&send=false&appId=&locale={locale}"},twitter:{url:"https://twitter.com/share?url={url}&text={title}&via={via}&hashtags={hashtags}"},google:{url:"https://plus.google.com/share?url={url}"},pinterest:{url:"https://pinterest.com/pin/create/bookmarklet/?media={img}&url={url}&is_video={is_video}&description={title}"},linkedin:{url:"http://www.linkedin.com/shareArticle?url={url}&title={title}"},buffer:{url:"http://bufferapp.com/add?text={title}&url={url}"},digg:{url:"http://digg.com/submit?url={url}&title={title}"},tumblr:{url:"http://www.tumblr.com/share/link?url={url}&name={title}&description={desc}"},reddit:{url:"http://reddit.com/submit?url={url}&title={title}"},stumbleupon:{url:"http://www.stumbleupon.com/submit?url={url}&title={title}"},delicious:{url:"https://delicious.com/save?v=5&provider={provider}&noui&jump=close&url={url}&title={title}"}};this.defaults={popupWidth:600,popupHeight:300},this.$get=["$window","$location",function(b,e){var f={defaults:angular.extend({url:e.absUrl()},c.defaults),getUrl:function(b,c){var e=d[b];if(!e)throw"Unknown template "+b;return c=angular.extend({},e.defaults||{},this.defaults||{},c||{}),a(e.url,c)},openPopup:function(c,e){var f=d[c];if(!f)throw"Unknown template "+c;e=angular.extend({},f.defaults||{},this.defaults||{},e||{});var g=e.popupWidth||800,h=e.popupHeight||500,i=Math.floor(((screen.availWidth||1024)-g)/2),j=Math.floor(((screen.availHeight||700)-h)/2),k=a(f.url,e),l=b.open(k,"social","width="+g+",height="+h+",left="+i+",top="+j+",location=0,menubar=0,toolbar=0,status=0,scrollbars=1,resizable=1");return l&&l.focus(),!!l}};return f}]}).directive("sharePopup",["ShareUrls",function(a){"use strict";return{restrict:"A",link:function(b,c,d){c.on("click",function(c){a.openPopup(d.sharePopup,d.shareOptions?b.$eval(d.shareOptions):{}),c.preventDefault()})}}}]),PIXI.DepthmapFilter=function(a){PIXI.AbstractFilter.call(this),this.passes=[this],this.uniforms={displacementMap:{type:"sampler2D",value:a},scale:{type:"2f",value:{x:.015,y:.015}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]},focus:{type:"1f",value:.5}},a.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=a.width,this.uniforms.mapDimensions.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","uniform float focus;","void main(void) {","   vec2 mapCords = vTextureCoord;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   float map = texture2D(displacementMap, mapCords).r;","   map = map * -1.0 + focus;","   vec2 disCords = vTextureCoord;","   disCords += offset * vec2(1.0, -1.0) * map * scale;","   gl_FragColor = texture2D(uSampler, disCords) * vColor;","}"]},PIXI.DepthmapFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.DepthmapFilter.prototype.constructor=PIXI.DepthmapFilter,PIXI.DepthmapFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(PIXI.DepthmapFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(a){this.uniforms.displacementMap.value=a}}),Object.defineProperty(PIXI.DepthmapFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.uniforms.scale.value=a}}),Object.defineProperty(PIXI.DepthmapFilter.prototype,"focus",{get:function(){return this.uniforms.focus.value},set:function(a){this.uniforms.focus.value=Math.min(1,Math.max(0,a))}}),Object.defineProperty(PIXI.DepthmapFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.uniforms.offset.value=a}}),angular.module("depthyApp").run(["$templateCache",function(a){"use strict";a.put("views/animation-options.html",'<div class=option><div class=btn-group><div class="btn btn-default btn-sm" ng-model=viewer.animDuration btn-radio=0.07 ga="">x_X</div><div class="btn btn-default btn-sm" ng-model=viewer.animDuration btn-radio=1 ga="">1s</div><div class="btn btn-default btn-sm" ng-model=viewer.animDuration btn-radio=2 ga="">2s</div><div class="btn btn-default btn-sm" ng-model=viewer.animDuration btn-radio=4 ga="">4s</div><div class="btn btn-default btn-sm" ng-model=viewer.animDuration btn-radio=6 ga="">6s</div></div></div><div class=option><div class=btn-group ng-model=viewer.animScale bs-radio-group=""><div class="btn btn-default btn-sm btn-icon" ng-model=viewer.animScale btn-radio="{x:1, y:0}" title="Left-right movement" ga=""><i class="icon icon-loop-flat"></i></div><div class="btn btn-default btn-sm btn-icon" ng-model=viewer.animScale btn-radio="{x:1, y:0.5}" title="Wide ellipse movement" ga=""><i class="icon icon-loop-ellipse"></i></div><div class="btn btn-default btn-sm btn-icon" ng-model=viewer.animScale btn-radio="{x:1, y:1}" title="Circle movement" ga=""><i class="icon icon-loop-circle"></i></div><div class="btn btn-default btn-sm btn-icon" ng-model=viewer.animScale btn-radio="{x:0.5, y:1}" title="Narrow ellipse movement" ga=""><i class="icon icon-loop-ellipse icon-rotate-90"></i></div><div class="btn btn-default btn-sm btn-icon" ng-model=viewer.animScale btn-radio="{x:0, y:1}" title="Top-bottom movement" ga=""><i class="icon icon-loop-flat icon-rotate-90"></i></div></div></div><div class=option><div class=btn-group><div class="btn btn-default btn-sm" ng-model=viewer.depthFocus btn-radio=0.00 ga="">Near</div><div class="btn btn-default btn-sm" ng-model=viewer.depthFocus btn-radio=0.50 ga="">Middle</div><div class="btn btn-default btn-sm" ng-model=viewer.depthFocus btn-radio=1.00 ga="">Far</div></div></div>'),a.put("views/export-modal.html",'<div class=modal-header><h4 class=modal-title>{{imageReady ? \'Here is your GIF!\' : \'Generating GIF\'}}</h4></div><div class=modal-body><div class=export-progress ng-if=!imageReady><div class="progress progress-striped active"><div class=progress-bar role=progressbar ng-style="{width: exportProgress * 100 + \'%\'}"></div></div><p class="text-muted text-center" ng-if=Modernizr.mobile>Generating GIFs on a mobile is a tedious task. If it takes too long, choose a smaller size or make it shorter...</p></div><div class="text-center export-image" ng-show=imageReady><img src="" title="Size is {{imageSize / 1024 / 1024 | number: 2}}MB"><p>Your GIF weights {{imageSize / 1024 / 1024 | number: 2}}MB and is ready to take! {{Modernizr.mobile ? \'Press and hold the image\' : \'Right-click the image\'}} to save it.</p><p ng-if="Modernizr.android && Modernizr.chrome && imageSize > 1000000" class="text-center text-warning">Due to the bug in Chrome the option to save the GIF can be unavailable. You\'ll have to make it smaller or share it.</p><p ng-if=imageOverLimit class="text-center text-warning">It\'s <b>too big</b> too share though.<br>You\'ll have to do it on your own, or make it smaller...</p><div ng-if=!imageOverLimit><p><em class=text-muted>or</em></p><div ng-switch=shareUrl class=export-share><div ng-switch-when=""><p class=text-danger ng-if=shareError>{{shareError}}</p><p><button class="btn btn-success btn-lg" ng-click=share()><i class="icon icon-cloud-upload"></i>Share it!</button><br></p><p class="text-muted disclaimer"><em>Your photo will be uploaded to <a href=http://imgur.com target=_blank>Imgur.com</a>.<br>It will remain relatively private until you share it too much and it will go viral.</em></p></div><div ng-switch-when=sharing><div class="progress progress-striped active"><div class=progress-bar role=progressbar ng-style="{width: shareProgress * 100 + \'%\'}"></div></div><p class=text-muted>Uploading, please wait...</p></div><div ng-switch-default="">Your GIF is now uploaded to:<br><p class=text-primary><a href={{shareUrl}} target=_blank>{{shareUrl}}</a></p><p>Copy this link and use it however you want or share it:<br><i class="icon link-share icon-twitter" share-popup=twitter share-options=share ga="[\'send\', \'event\', \'export\', \'share\', \'twitter\']"></i> <i class="icon link-share icon-facebook" share-popup=facebook share-options=share ga="[\'send\', \'event\', \'export\', \'share\', \'facebook\']"></i> <i class="icon link-share icon-googleplus" share-popup=google share-options=share ga="[\'send\', \'event\', \'export\', \'share\', \'google\']"></i></p></div></div></div><p>To gain good karma use <b>#depthy</b> in your shares, thanks!</p></div></div><div class=modal-footer><button class="btn btn-default" ng-click=$close()>Close</button></div>'),a.put("views/export-popup.html",'<div class="popover-content scrollable"><div class=option><div class=btn-group><div class="btn btn-default btn-sm" ng-model=depthy.exportSize btn-radio=150>Small</div><div class="btn btn-default btn-sm" ng-model=depthy.exportSize btn-radio=300>Standard</div><div class="btn btn-default btn-sm" ng-model=depthy.exportSize btn-radio=500>Large</div></div></div><div ng-include="\'views/animation-options.html\'"></div><div ng-include="\'views/movement-options.html\'"></div></div><div class=popover-footer><button class="btn btn-success btn-lg" ng-click=startExport()><i class="icon icon-yes"></i>C\'mon!</button>&nbsp; <button class="btn btn-default btn-sm" ng-click="depthy.exportPopuped = false">Nah...</button></div>'),a.put("views/main.html",'<div id=main ng-controller=MainCtrl><header><div class="container text-center"><h1>Depthy</h1><p class=lead>Poke around with awesome photos<br>made with <a href="https://play.google.com/store/apps/details?id=com.google.android.GoogleCamera" target=_blank>Google Camera</a>\'s Lens Blur.</p><p>Make a photo using Lens Blur mode and load it using the button below.<br>Photos are processed on your device - no uploading! <span ng-if=!Modernizr.mobile><br>It works on your Android device too!</span></p><p ng-if=!Modernizr.webgl>Please note, that your browser does not support WebGL. You\'ll not see the parallax effect...<br>Try using Chrome on your desktop or Android device</p><div class=file-select ng-class="{processing: !viewer.sourcesReady && !viewer.error}"><a class="btn btn-lg btn-success" ng-href=# ng-click=selectFile($event)>Load the Lens Blur photo</a><div class="progress progress-striped active"><div class=progress-bar role=progressbar style="width: 100%"></div></div></div><em class=text-muted ng-if=!Modernizr.mobile>or drag&amp;drop it anywhere</em><div class=gallery><img src=samples/flowers-thumb.jpg ng-click="loadSample(\'flowers\')"> <img src=samples/hut-thumb.jpg ng-click="loadSample(\'hut\')"> <img src=samples/shelf-thumb.jpg ng-click="loadSample(\'shelf\')"> <img src=samples/mango-thumb.jpg ng-click="loadSample(\'mango\')"> <img src=samples/tunnel-thumb.jpg ng-click="loadSample(\'tunnel\')"></div></div></header><div id=error class=ng-hide ng-hide=!depthy.viewer.error><h2>{{depthy.viewer.error}}</h2><p>Make sure you only select photos made in the Lens Blur mode.</p><a class="btn btn-md btn-danger" ng-click="depthy.viewer.error = \'\'">Got it!</a></div><div id=viewer ng-hide=viewer.error ng-if=Modernizr.webgl><div class=text-center><h2>Parallax view</h2><p class=text-muted>Move your {{Modernizr.devicemotion && Modernizr.mobile ? \'device\' : \'cursor\'}} around to see the effect</p></div><div class=depthy-viewer depthy-viewer=depthy.viewer ng-style="{height: v.viewerSize.height + \'px\'}"><canvas pixi=stage pixi-render=pixiRender pixi-transparent=true pixi-renderer="\'webgl\'" ng-style="{\r\n          width: v.stageCssSize.width + \'px\', \r\n          height: v.stageCssSize.height + \'px\', \r\n          \'margin-left\': v.stageCssSize.width / -2 + \'px\', \r\n          \'margin-top\': v.stageCssSize.height / -2 + \'px\'}"></canvas></div><div class=text-center><div class=buttons-options><button class="btn btn-primary button-usecompound" ng-click="viewer.useCompoundImage = !viewer.useCompoundImage" ga="">{{viewer.useCompoundImage ? \'Sharpen\' : \'Blur\'}}</button> <span class="popup-group button-animate"><div class="popover top anim-fade" ng-if=depthy.animatePopuped><div class=arrow></div><div class=popover-content ng-include="\'views/animation-options.html\'"></div></div><div class=btn-group><button class="btn btn-primary" ng-click="viewer.animate = !viewer.animate" ng-class="{active: viewer.animate}" ga="">Hypnotize</button> <button type=button class="btn btn-primary" ng-click=toggleAnimatePopup() ga="" ga-label="\'Hypnotize options\'"><span class=caret></span></button></div></span> <button class="btn btn-primary button-scale" ng-click=cycleDepthScale() ga="">{{getNextDepthScaleName()}}</button></div><div class="button-export popup-group"><div class="popover top anim-fade" ng-if=depthy.exportPopuped><div ng-include="\'views/export-popup.html\'"></div></div><button id=button-export class="btn btn-success btn-lg" ng-click=toggleExportPopup() ga=""><i class="icon icon-movie"></i>Create GIF</button></div></div></div><div id=file ng-show="viewer.sourcesReady && !viewer.error"><h2>Extracted images</h2><div class=images><div id=image class=image ng-class="{empty: !hasImage()}"><img ng-hide=!hasImage() image-source=image></div><div id=depth class=image ng-class="{empty: !hasDepth()}"><img ng-hide=!hasDepth() image-source=depth></div></div></div><footer>Depthy 0.1.1 created by <a href="http://www.stamina.pl/">Rafał Lindemann</a>.<br>Ideas? Issues? Code? It\'s open sourced on <a href=https://github.com/panrafal/depthy>GitHub</a>!</footer></div>'),a.put("views/movement-options.html",'<div class=option><div class=btn-group><div class="btn btn-default btn-sm" ng-model=viewer.depthScale btn-radio=0.5 ga="">Calm</div><div class="btn btn-default btn-sm" ng-model=viewer.depthScale btn-radio=1 ga="">Normal</div><div class="btn btn-default btn-sm" ng-model=viewer.depthScale btn-radio=2 ga="">Dramatic</div></div></div>'),a.put("bower_components/angular-ui-bootstrap/template/modal/backdrop.html",'<div class="modal-backdrop fade" ng-class="{in: animate}" ng-style="{\'z-index\': 1040 + index*10}"></div>'),a.put("bower_components/angular-ui-bootstrap/template/modal/window.html",'<div tabindex=-1 class="modal fade {{ windowClass }}" ng-class="{in: animate}" ng-style="{\'z-index\': 1050 + index*10, display: \'block\'}" ng-click=close($event)><div class=modal-dialog><div class=modal-content ng-transclude=""></div></div></div>')
}]),angular.module("depthyApp").run(["$templateCache",function(a){"use strict";a.put("template/modal/backdrop.html",'<div class="modal-backdrop fade" ng-class="{in: animate}" ng-style="{\'z-index\': 1040 + index*10}"></div>'),a.put("template/modal/window.html",'<div tabindex=-1 class="modal fade {{ windowClass }}" ng-class="{in: animate}" ng-style="{\'z-index\': 1050 + index*10, display: \'block\'}" ng-click=close($event)><div class=modal-dialog><div class=modal-content ng-transclude=""></div></div></div>')}]),angular.module("depthyApp").controller("ExportModalCtrl",["$scope","$modalInstance","$rootElement","depthy","ga",function(a,b,c,d,e){a.exportProgress=-1,a.imageReady=!1,a.shareUrl="",a.tweetUrl=null,a.imageOverLimit=!1;var f=d.exportAnimation(),g=null,h=null,i=new Date,j="size "+d.exportSize+" dur "+d.viewer.animDuration;e("send","event","gif","start",j),f.then(function(b){e("send","timing","gif","created",new Date-i,j),e("send","event","gif","created",j,b.size),a.imageSize=b.size,a.imageOverLimit=b.size>2097152;var d=new FileReader;d.onload=function(){h=d.result;var e=c.find(".export-modal .export-image img")[0];e.src=Modernizr.android&&Modernizr.chrome?h:URL.createObjectURL(b),a.imageReady=!0,a.$safeApply()},d.readAsDataURL(b)},function(){a.exportError="Export failed"},function(b){a.exportProgress=b,a.$safeApply()}),a.share=function(){e("send","event","gif","upload",j,a.imageSize),a.shareUrl="sharing",a.shareError=null,a.shareProgress=0,g=$.ajax({url:"https://api.imgur.com/3/image.json",method:"POST",headers:{Authorization:"Client-ID "+d.imgurId,Accept:"application/json"},data:{image:h.substr("data:image/gif;base64,".length),type:"base64",name:d.loadedName,title:d.loadedName+" #depthy",description:"Created using http://depthy.stamina.pl"},xhr:function(){var b=new window.XMLHttpRequest;return b.upload.addEventListener("progress",function(b){b.lengthComputable&&(a.shareProgress=b.loaded/b.total,a.$safeApply())},!1),b}}).done(function(b,c,f){console.log(b,c,f);var h=b.data.id;e("send","event","gif","upload-success"),a.shareUrl="https://imgur.com/"+h,a.share={url:a.shareUrl,title:d.loadedName+" #depthy",img:"https://i.imgur.com/"+h+".gif"},g=null,a.$safeApply()}).fail(function(b,c){var d=b.responseJSON||{};g=null,a.shareUrl="",a.shareError=(d.data||{}).error||"Something went wrong... Please try again.",console.error("Share failed with ",d),e("send","event","gif","upload-error",c+": "+a.shareError),a.$safeApply()})},a.$close=function(){console.log("close"),f&&f.abort(),g&&g.abort(),a.imageUrl&&URL.revokeObjectURL(a.imageUrl),b.close()}}]);